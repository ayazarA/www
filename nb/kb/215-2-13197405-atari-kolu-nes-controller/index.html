<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <meta name="author" content="Alper Yazar">
    <link rel="canonical" href="http://www.ayazar.com/nb/kb/215-2-13197405-atari-kolu-nes-controller/">
    <link rel="../../../img/favicon.ico">

    
    <title>Atari Kolu (NES Controller) Arayüzü (215-2-13197405) - Alper Yazar</title>
    

    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.12.0/css/all.css">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.12.0/css/v4-shims.css">
    <link rel="stylesheet" href="//cdn.jsdelivr.net/npm/hack-font@3.3.0/build/web/hack.min.css">
    <link href='//rsms.me/inter/inter.css' rel='stylesheet' type='text/css'>
    <link href='//fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,700italic,400,300,600,700&subset=latin-ext,latin' rel='stylesheet' type='text/css'>
    <link href="../../../css/bootstrap-custom.min.css" rel="stylesheet">
    <link href="../../../css/base.min.css" rel="stylesheet">
    <link href="../../../css/cinder.min.css" rel="stylesheet">

    
        
        <link rel="stylesheet" href="//cdn.jsdelivr.net/gh/highlightjs/cdn-release@9.18.0/build/styles/github.min.css">
        
    

    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
            <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
            <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
        <![endif]-->

    
    <script>
    (function(i, s, o, g, r, a, m) {
        i['GoogleAnalyticsObject'] = r;
        i[r] = i[r] || function() {
            (i[r].q = i[r].q || []).push(arguments)
        }, i[r].l = 1 * new Date();
        a = s.createElement(o),
        m = s.getElementsByTagName(o)[0];
        a.async = 1;
        a.src = g;
        m.parentNode.insertBefore(a, m)
    })(window, document, 'script', '//www.google-analytics.com/analytics.js', 'ga');

    ga('create', 'UA-155131137-1', 'ayazar.com');
    ga('send', 'pageview');
    </script>
    

    


</head>

<body>

    <div class="navbar navbar-default navbar-fixed-top" role="navigation">
    <div class="container">

        <!-- Collapsed navigation -->
        <div class="navbar-header">
            <!-- Expander button -->
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            

            <!-- Main title -->

            <a class="navbar-brand" href="../../..">Alper Yazar</a>
        </div>

        <!-- Expanded navigation -->
        <div class="navbar-collapse collapse">
                <!-- Main navigation -->
                <ul class="nav navbar-nav">
                
                
                    <li >
                        <a href="../../..">About</a>
                    </li>
                
                
                
                    <li >
                        <a href="../../../contact/">Contact - İletişim</a>
                    </li>
                
                
                
                    <li >
                        <a href="../../../blog/">Blog</a>
                    </li>
                
                
                
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Notebook <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                        
                            
<li >
    <a href="../../d/">Dictionary</a>
</li>

                        
                            
<li >
    <a href="../">Knowledge Base</a>
</li>

                        
                            
<li >
    <a href="../../n/">Notes</a>
</li>

                        
                            
<li >
    <a href="../../r/">Reviews - İncelemeler</a>
</li>

                        
                            
<li >
    <a href="../../l/">Lists</a>
</li>

                        
                        </ul>
                    </li>
                
                
                
                    <li >
                        <a href="../../../misc/">Misc.</a>
                    </li>
                
                
                </ul>

            <ul class="nav navbar-nav navbar-right">
                    <li>
                        <a href="#" data-toggle="modal" data-target="#mkdocs_search_modal">
                            <i class="fas fa-search"></i> Search
                        </a>
                    </li>
                    <li>
                        <a href="https://github.com/alperyazar/www/edit/master/docs/nb/kb/215-2-13197405-atari-kolu-nes-controller.md"><i class="fab fa-github"></i> Edit on GitHub</a>
                    </li>
            </ul>
        </div>
    </div>
</div>

    <div class="container">
        
        
        <div class="col-md-3"><div class="bs-sidebar hidden-print affix well" role="complementary">
    <ul class="nav bs-sidenav">
        <li class="first-level active"><a href="#atari-kolu-nes-controller-arayuzu-215-2-13197405">Atari Kolu (NES Controller) Arayüzü (215-2-13197405)</a></li>
            <li class="second-level"><a href="#atari-kolunun-sinyalleri">Atari Kolunun Sinyalleri</a></li>
                
            <li class="second-level"><a href="#pic-ile-atari-kolunun-kullanlmas">PIC ile Atari Kolunun Kullanılması</a></li>
                
            <li class="second-level"><a href="#kaynaklar">Kaynaklar</a></li>
                
    </ul>
</div></div>
        <div class="col-md-9" role="main">

<h1 id="atari-kolu-nes-controller-arayuzu-215-2-13197405">Atari Kolu (NES Controller) Arayüzü (215-2-13197405)</h1>
<p>Benim yaşımdakiler için herhalde çocukluğunda atari ile karşılaşmamış kişi pek yoktur. Atari ismi bildiğim kadarı ile Atari firmasının ürettiği bir "oyun makinası" ile genelleşmiş bir isim olmuştur. Benim gibi hala vakit bulduğu zaman atari oynayan var mıdır bilmiyorum. Fakat bana tüm bilgisayar oyunlarından daha zevkli gelmektedir. Özellikle babamla beraber oynadığım meşhur <strong>Tank 90</strong> oyununun yeri başkadır. Rekor skorumuz olan <strong>253800</strong>’ü Eylül 2011 ayında yapmış bulunmaktayız. Elbet ki daha yüksek yapanlar vardır fakat biz bayağı emek verdik bu skora çıkmak için. :) Rekorumuzun fotoğrafı da aşağıda:</p>
<p><img alt="Tank oyununda babam ile yaptığımız rekor." src="../img/215-2-13197405-a.jpg" /></p>
<p><em>Tank oyununda babam ile yaptığımız rekor.</em></p>
<p>Bendeki atari şu şekilde:</p>
<p><img alt="Emektar Atarim" src="../img/215-2-13197405-b.jpg" /></p>
<p><em>Emektar Atarim</em></p>
<p>Alttaki gri kol, atarinin içerisinden çıkan kol. Üstteki kırmızı, Micro Genius kolu orijinal kolların kabloları bir süre sonra temassızlık yapıp, çalışmayınca almıştım. Atarimin orijinal adı internetten bulduğum kadarı ile Famicom firmasının ürettiği Family Computer. Galiba çoğu kişideki atariden farkı kaset olmadan da kendi içinde Tank 90 gibi oyunlar barındırması. Bu yüzden zamanında sadece 2 adet atari kasetim olmuştu. Birini de küçükken bir arkadaş alıp, geri vermeyince elimde bir tane kaldı. :D</p>
<p>Atari anılarımızı tazeledikten sonra gelelim yazının asıl konusuna. Bu yazıda elimden geldiğince bir atari kolunun, daha doğru adı ile "NES (Nintendo Entertainment System) Controller"ın nasıl çalıştığını ve bu aleti atari dışında, kendi yaptığımız devreler gibi yerlerde nasıl kullanabileceğimizi anlatmaya çalışacağım.</p>
<p>Atari kolunda toplamda 8 adet düğme bulunmaktadır: Yukarı, Aşağı, Sağa, Sola, A, B, Start ve Select. Yukarıdaki fotoğrafta da görebileceğiniz gibi iki adet de Turbo tuşu bulunmaktadır. Yani toplamda kol üzerinde 10 adet düğme vardır. Peki neden 8 düğme var diyorsun derseniz nedeni de şudur: Turbo A, A tuşu ile Turbo B ise B tuşu ile atariye aynı sinyali göndermektedir. Yani atari tarafında Turbo A ile A’nın ve Turbo B ile B’nin bir farkı yok. Fakat, örneğin nasıl oluyor da A ile bir kez ateş edip, Turbo A ile sürekli ateş ediyoruz derseniz o da anladığım kadarı ile şöyle oluyor: Burada sürekli ateş etmeyi sağlayan şey aslında kumanda. Biz A’ya basıp, basılı tuttuğumuzda atari sürekli A’ya basılıyor diyor ve elimizi çekip, tekrar basana kadar yeni bir atış yaptırtmıyor. Tabi bu oyundan oyuna değişebilir. Fakat Turbo tuşlarına bastığımız zaman her ne kadar biz tuşa basılı tutsak da, atari kolu içerisindeki devre bizim yerimize A tuşuna sürekli basıp, çekiyor. Böylece Turbo A’yı basılı tutmak, A tuşuna elimizle sürekli basıp çekmeye eşdeğer oluyor. Kumanda ile uğraşırken ilk başta hep 10 ayrı tuş var diye düşünüyordum ve internetteki kaynaklarda bu kolların 8 tuşlu ve 16 tuşlu versiyonların bulunduğunu okuduğumdan, ben 16 tuşlu kumanda devresi olduğunu sanıyordum ve buna başlarda zaman kaybettirdi. Çünkü iki tip kumandanın sinyal zamanlamaları birbirlerinden farklı.</p>
<p>Karşılaştığım diğer bir zorluk da hangi kablonun ne işe yaradığını bulmak oldu. İnternette verilen pin diyagramı ve kablo renk bilgilerinin neredeyse hepsi 7 pinli soketi olan kollar için. Benim elimdeki tüm kollar DB-9 (seri port soketi) dişi sokete sahip. Ayrıca kolları söktüğüm zaman kablo renklerinin, internette verilenler renklerle uyuşmadığını gördüm. Bundan dolayı atariyi de söküp, çeşitli ölçümler yaparak hangi kablonun ne işe yaradığını bulabildim. Gerçi işimi bitirdikten sonra bir sitede elimdeki kollar için de bilgi olduğunu görünce iyi bir araştırma yapmadan direkt işe giriştiğime üzülmedim değil. En azından internetteki kaynaktan, çıkardığım pin bağlantı tablosunun doğru olduğunu görünce biraz sevindim. :) Atari kolunun ucundaki soket (bildiğimiz dişi seri port soketi) şu şekilde bir şey:</p>
<p><img alt="Bendeki Atari Kolunun Soketi" src="../img/215-2-13197405-c.jpg" /></p>
<p><em>Bendeki Atari Kolunun Soketi</em></p>
<p>Her ne kadar 9 adet pin olsa da toplamda 5 adeti kullanılıyor. Kola giden kabloların isimleri de şu şekilde: <strong>VCC, GND, Clk, Latch, Data</strong>. Hatların işlevlerine bakmadan önce bu tarz bir soketi olan atari kolunda hangi pine, hangi kablonun bağlı olduğunu gösteren ve daha rahat geldiği için elle yazdığım pin bağlantı diyagramını göstermek istiyorum:</p>
<p><img alt="Atari Kolunun Pin Bağlantıları" src="../img/215-2-13197405-d.jpg" /></p>
<p><em>Atari Kolunun Pin Bağlantıları</em></p>
<p>Atari kolunun soketini kendinize doğru, çizimde gösterdiğim gibi tuttuğunuz zaman pin isimleri bu şekilde olmaktadır. <strong>Yani benim üsteki fotoğraftaki tuttuğum şekil ile değil, onun 180 derece çevrilmiş şekli ile tutmalısınız.</strong> NC olarak belirtilen pinlere herhangi bir kablo bağlı değil. Kol, 5 V ile çalışıyor. Data, Latch ve Clock sinyalleri için lojik 1 5 V’ye ve lojik 0 0 V’ye karşılık geliyor.</p>
<p>Kumandayı bağlamak için bir elektronikçiden erkek seri port soketi alıp, kullanabilirsiniz. Bilmeyenler için kendisi şöyle bir şey oluyor: (Net fotoğraf çekemedim maalesef.)</p>
<p><img alt="Atari kolunu takabileceğiniz erkek seri port soketi" src="../img/215-2-13197405-e.jpg" /></p>
<p><em>Atari kolunu takabileceğiniz erkek seri port soketi</em></p>
<h2 id="atari-kolunun-sinyalleri">Atari Kolunun Sinyalleri</h2>
<p>Atari kolunu devremizde kullanmak için belirttiğim 5 hattı kullanmamız gerekiyor. Bunlardan ikisi zaten besleme. Atari kolumuzu 5 V ile çalıştırıyoruz. Latch sinyalinin yükselen kenarında kol, tüm düğmelerin durumlarını içerisindeki flip-floplar yardımıyla kaydediyor. Daha sonra biz Clock hattının yükselen kenarında kayıt ettiği durumları Data hattı üzerinden tek tek bize gönderiyor. Bu kadar basit. :) İnternetteki kaynaklara göre, atari kolunun içerisinde bu işi yapan temel eleman 4021 adında 8 bit bir shift register entegresi. Tabi bendeki kollar gibi Turbo tuşları bulunan kolların içerisinde yüksek ihtimalle, bu tuşlara bastığımız zaman kumandanın bizim yerimize tuşa basıp çekmesini sağlayan ek devreler bulunuyor. Elle çizmiş olduğum aşağıdaki örnek sinyal diyagramı kumandayı kullanmak için kullanılabilir:</p>
<p><img alt="Atari kolunu kullanmak için örnek bir sinyalizasyon" src="../img/215-2-13197405-f.jpg" /></p>
<p><em>Atari kolunu kullanmak için örnek bir sinyalizasyon</em></p>
<p>Latch sinyalinin yükselen kenarlarında yazmış olduğum “Tüm düğmeler “sample”lanır.” adlı tarzanca notum için özür dilerim. :) Buradaki Latch ve Clock sinyalinin frekansı size kalmış. Alt limit yok fakat tahmin edebileceğiniz gibi bir üst limit yok. Üst limiti tam olarak bilmiyorsam da sanki bir kaynakta 10 MHz civarı bir hız yazıyordu. Daha net bilgi için başka kaynaklara bakabilirsiniz. Fakat bir atari kolunu bu kadar hızlı okumak gerekir mi, tartışılır. İnternetteki çoğu kaynakta atarilerin saniyede 60 okuma yaptığı yazıyor. Bir kolu okumak için yetip de artacak bir hız. Burada dikkat edilmesi gereken nokta düğmelerin okunuş sırası. Sıra ile şu düğmelerin bilgisi geliyor:</p>
<p><strong>A, B, Select, Start, Yukarı, Aşağı, Sola, Sağa</strong></p>
<p><strong>Eğer düğme basılı ise 0, değilse 1 okuyoruz.</strong></p>
<p>Yukarıda da belirttiğim gibi tüm düğmeler Latch sinyalinin yükselen kenarında okunup, kaydediliyor. Clock sinyalini kullanıp, tek tek düğmeleri okurkenki değerler Latch sinyalinin yükseldiği ana ait.</p>
<h2 id="pic-ile-atari-kolunun-kullanlmas">PIC ile Atari Kolunun Kullanılması</h2>
<p>Denemek için Pic Basic Pro dilinde aşağıdaki basit programı yazmıştım. Çalışmasını aşağıdaki videodan görebilirsiniz. Burada kod yazarak yaptığım şey, yukarıdaki sinyalizasyonu PIC ile gerçekleştirmek ve düğmelerin durumuna göre 8 adet LED’i yakıp söndürmek. Kodun incelenerek anlaşılabileceğini düşünüyorum.</p>
<p>Devre şemasını vermeye gerek görmüyorum çünkü devrede neredeyse hiç bir eleman yok. PIC 16F628’in dahili osilatörünü kullandığımdan, PIC’in çalışması için 5 V vermemiz yeterli. Kumandadan aldığımız hatları direkt PIC pinlerine girebiliriz. Biraz daha önlem almak isterseniz Latch ve Clock sinyalleri için akım limitlemeye yönelik eklemeler yapabilirsiniz. Özellikle kumandanın sökük olduğu durumlar için yanlış veri okumamak adına Data hattına 10 K gibi bir pull up direnci bağlanabilir. Çektiğim videoda pull up direnci takılı durumda.</p>
<pre><code class="basic">@ DEVICE pic16f628, WDT_OFF
@ DEVICE pic16f628, PWRT_OFF
@ DEVICE pic16f628, BOD_OFF
@ DEVICE pic16f628, LVP_OFF
@ DEVICE pic16F628, PROTECT_OFF
@ DEVICE pic16f628, MCLR_OFF
@ DEVICE pic16f628, INTRC_OSC_NOCLKOUT
DEFINE OSC 4
'''
latch var portb.0
clk var portb.1
data_out var portb.2
led_geri var portb.3
led_yukari var portb.4
led_sola var portb.5
led_saga var portb.6
led_a var portb.7
led_b var porta.0
led_start var porta.1
led_select var porta.2

CMCON=7
TRISA = %11111000
TRISB = 000100

latch=0
clk=0
led_geri = 1
led_yukari = 1
led_sola = 1
led_saga = 1
led_a = 1
led_b = 1
led_start = 1
led_select = 1
pause 1000
led_geri = 0
led_yukari = 0
led_sola = 0
led_saga = 0
led_a = 0
led_b = 0
led_start = 0
led_select = 0

tara:

latch=1
pause 1
latch=0
pause 5
if data_out = 0 then 'A
led_a = 1
else
led_a = 0
endif

clk=1
pause 5
if data_out = 0 then 'b
led_b = 1
else
led_b = 0
endif
clk=0
pause 5

clk=1
pause 5
if data_out = 0 then 'select
led_select = 1
else
led_select = 0
endif
clk=0
pause 5

clk=1
pause 5
if data_out = 0 then 'start
led_start = 1
else
led_start = 0
endif
clk=0
pause 5

clk=1
pause 5
if data_out = 0 then 'yukarı
led_yukari = 1
else
led_yukari = 0
endif
clk=0
pause 5

clk=1
pause 5
if data_out = 0 then 'aşağı
led_geri = 1
else
led_geri = 0
endif
clk=0
pause 5

clk=1
pause 5
if data_out = 0 then 'sol
led_sola = 1
else
led_sola = 0
endif
clk=0
pause 5

clk=1
pause 5
if data_out = 0 then 'sag
led_saga = 1
else
led_saga = 0
endif
clk=0
pause 5

goto tara
</code></pre>

<p>Bu kodun çalışması şu videodaki gibi olmaktadır:</p>
<iframe width="560" height="315" src="https://www.youtube.com/embed/JlvE-LjGIOQ" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>

<h2 id="kaynaklar">Kaynaklar</h2>
<ul>
<li><a href="http://www.mit.edu/~tarvizo/nes-controller.html">http://www.mit.edu/~tarvizo/nes-controller.html</a></li>
<li><a href="http://www.gamesx.com/controldata/nessnes.htm">http://www.gamesx.com/controldata/nessnes.htm</a></li>
<li><a href="http://davr.org/snes/joystick.txt">http://davr.org/snes/joystick.txt</a></li>
</ul></div>
        
        
    </div>

    <footer class="col-md-12 text-center">
        
<hr>
<p>
    <small>License: <a href='https://creativecommons.org/licenses/by-sa/4.0/'>CC-BY-SA-4.0</a></small><br>


    <small><i>Created on 2011-09-25</i></small><br>


    <small><i>Last Updated on 2020-01-24</i></small><br>

<small>Built with <a href="http://www.mkdocs.org/">MkDocs</a> version 1.0.4 on 2020-02-16 18:12:52 UTC.</small><br>
<img src="https://img.shields.io/uptimerobot/ratio/m784066757-5d6b061dfaf9531f911b85ca.svg"/>
<a href="https://github.com/alperyazar/www/graphs/commit-activity"><img src="https://img.shields.io/github/commit-activity/m/alperyazar/www.svg"/></a>
<img src="https://img.shields.io/github/last-commit/alperyazar/www/master"/>
<img src="https://img.shields.io/github/repo-size/alperyazar/www"/>
<img src="https://img.shields.io/github/license/alperyazar/www"/>
</p>

    </footer>
    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
    <script src="../../../js/bootstrap-3.0.3.min.js"></script>
    
    <script src="//cdn.jsdelivr.net/gh/highlightjs/cdn-release@9.18.0/build/highlight.min.js"></script>
    <script src="//cdn.jsdelivr.net/gh/highlightjs/cdn-release@9.18.0/build/languages/matlab.min.js"></script>
    <script src="//cdn.jsdelivr.net/gh/highlightjs/cdn-release@9.18.0/build/languages/latex.min.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>
    
    <script>var base_url = "../../.."</script>
    
    <script src="../../../js/base.js"></script>
    <script src="../../../search/main.js"></script>

    <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="searchModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal">
                    <span aria-hidden="true">&times;</span>
                    <span class="sr-only">Close</span>
                </button>
                <h4 class="modal-title" id="searchModalLabel">Search</h4>
            </div>
            <div class="modal-body">
                <p>
                    From here you can search these documents. Enter
                    your search terms below.
                </p>
                <form>
                    <div class="form-group">
                        <input type="text" class="form-control" placeholder="Search..." id="mkdocs-search-query" title="Type search term here">
                    </div>
                </form>
                <div id="mkdocs-search-results"></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div><div class="modal" id="mkdocs_keyboard_modal" tabindex="-1" role="dialog" aria-labelledby="keyboardModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="keyboardModalLabel">Keyboard Shortcuts</h4>
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
            </div>
            <div class="modal-body">
              <table class="table">
                <thead>
                  <tr>
                    <th style="width: 20%;">Keys</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td class="help shortcut"><kbd>?</kbd></td>
                    <td>Open this help</td>
                  </tr>
                  <tr>
                    <td class="next shortcut"><kbd>n</kbd></td>
                    <td>Next page</td>
                  </tr>
                  <tr>
                    <td class="prev shortcut"><kbd>p</kbd></td>
                    <td>Previous page</td>
                  </tr>
                  <tr>
                    <td class="search shortcut"><kbd>s</kbd></td>
                    <td>Search</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>
    </body>

</html>
