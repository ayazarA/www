<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <meta name="author" content="Alper Yazar">
    <link rel="canonical" href="http://www.ayazar.com/nb/kb/215-2-87940435-windows-10-grub-bozulmasi/">
    <link rel="../../../img/favicon.ico">

    
    <title>Windows 10 1803->1903 Yükseltmesi Sırasında GRUB’un Bozulması (215-2-87940435) - Alper Yazar</title>
    

    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.12.0/css/all.css">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.12.0/css/v4-shims.css">
    <link rel="stylesheet" href="//cdn.jsdelivr.net/npm/hack-font@3.3.0/build/web/hack.min.css">
    <link href='//rsms.me/inter/inter.css' rel='stylesheet' type='text/css'>
    <link href='//fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,700italic,400,300,600,700&subset=latin-ext,latin' rel='stylesheet' type='text/css'>
    <link href="../../../css/bootstrap-custom.min.css" rel="stylesheet">
    <link href="../../../css/base.min.css" rel="stylesheet">
    <link href="../../../css/cinder.min.css" rel="stylesheet">

    
        
        <link rel="stylesheet" href="//cdn.jsdelivr.net/gh/highlightjs/cdn-release@9.18.0/build/styles/github.min.css">
        
    

    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
            <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
            <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
        <![endif]-->

    
    <script>
    (function(i, s, o, g, r, a, m) {
        i['GoogleAnalyticsObject'] = r;
        i[r] = i[r] || function() {
            (i[r].q = i[r].q || []).push(arguments)
        }, i[r].l = 1 * new Date();
        a = s.createElement(o),
        m = s.getElementsByTagName(o)[0];
        a.async = 1;
        a.src = g;
        m.parentNode.insertBefore(a, m)
    })(window, document, 'script', '//www.google-analytics.com/analytics.js', 'ga');

    ga('create', 'UA-155131137-1', 'ayazar.com');
    ga('send', 'pageview');
    </script>
    

    


</head>

<body>

    <div class="navbar navbar-default navbar-fixed-top" role="navigation">
    <div class="container">

        <!-- Collapsed navigation -->
        <div class="navbar-header">
            <!-- Expander button -->
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            

            <!-- Main title -->

            <a class="navbar-brand" href="../../..">Alper Yazar</a>
        </div>

        <!-- Expanded navigation -->
        <div class="navbar-collapse collapse">
                <!-- Main navigation -->
                <ul class="nav navbar-nav">
                
                
                    <li >
                        <a href="../../..">About</a>
                    </li>
                
                
                
                    <li >
                        <a href="../../../contact/">Contact - İletişim</a>
                    </li>
                
                
                
                    <li >
                        <a href="../../../blog/">Blog</a>
                    </li>
                
                
                
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Notebook <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                        
                            
<li >
    <a href="../../d/">Dictionary</a>
</li>

                        
                            
<li >
    <a href="../">Knowledge Base</a>
</li>

                        
                            
<li >
    <a href="../../n/">Notes</a>
</li>

                        
                            
<li >
    <a href="../../r/">Reviews - İncelemeler</a>
</li>

                        
                            
<li >
    <a href="../../l/">Lists</a>
</li>

                        
                        </ul>
                    </li>
                
                
                
                    <li >
                        <a href="../../../misc/">Misc.</a>
                    </li>
                
                
                </ul>

            <ul class="nav navbar-nav navbar-right">
                    <li>
                        <a href="#" data-toggle="modal" data-target="#mkdocs_search_modal">
                            <i class="fas fa-search"></i> Search
                        </a>
                    </li>
                    <li>
                        <a href="https://github.com/alperyazar/www/edit/master/docs/nb/kb/215-2-87940435-windows-10-grub-bozulmasi.md"><i class="fab fa-github"></i> Edit on GitHub</a>
                    </li>
            </ul>
        </div>
    </div>
</div>

    <div class="container">
        
        
        <div class="col-md-3"><div class="bs-sidebar hidden-print affix well" role="complementary">
    <ul class="nav bs-sidenav">
        <li class="first-level active"><a href="#windows-10-1803-1903-yukseltmesi-srasnda-grubun-bozulmas-215-2-87940435">Windows 10 1803-&gt;1903 Yükseltmesi Sırasında GRUB’un Bozulması (215-2-87940435)</a></li>
            <li class="second-level"><a href="#sorun">Sorun</a></li>
                
            <li class="second-level"><a href="#cozum">Çözüm</a></li>
                
                <li class="third-level"><a href="#1-deneme-basarsz">1. Deneme (Başarısız)</a></li>
                <li class="third-level"><a href="#2-deneme-basarl">2. Deneme (Başarılı)</a></li>
            <li class="second-level"><a href="#sebebi-neydi-ki">Sebebi neydi ki?</a></li>
                
    </ul>
</div></div>
        <div class="col-md-9" role="main">

<h1 id="windows-10-1803-1903-yukseltmesi-srasnda-grubun-bozulmas-215-2-87940435">Windows 10 1803-&gt;1903 Yükseltmesi Sırasında GRUB’un Bozulması (215-2-87940435)</h1>
<h2 id="sorun">Sorun</h2>
<p>Windows 10 1803 ve Debian 9 dual boot çalışan (fiziksel olarak aynı diskte kurulu) dizüstü bilgisayarımın Windows’unu 1903’e "Update Assistant" (bknz: <a href="https://www.microsoft.com/tr-tr/software-download/windows10">Link</a> ve <a href="https://go.microsoft.com/fwlink/?LinkID=799445">Link</a> ) kullanarak yükselttim. Windows’un kendi update kısmında 1903 çıkmadığı için (çok benzer sürüm çalıştıran masaüstü bilgisayarımda çıkmıştı) bu asistanı kullandım ama bu sorun ile ilgisi olduğunu sanmıyorum. Güncelleme sırasında bilgisayar birkaç kez reboot ediyor. Benim default GRUB ayarım Debian açılacak şekilde. Bu reboot yapma sırasında bir kez GRUB ekranını kaçırarak Debian’ın açılmasına sebep oldum. Buradan da tekrar reboot edip, Windows’u açarak güncellemenin devam etmesini sağladım. Masaüstü bilgisayarımda böyle bir an yaşanmadı ama yine sorunun bundan kaynaklanacağını zannetmiyorum. Daha sonra olan bir reboot sırasında GRUB menüsü gelemeden BIOS mesajından sonra şu yazı beni karşıladı:</p>
<pre><code class="text">error: unknown filesystem.
Entering rescue mode...
grub rescue&gt;
</code></pre>

<p>Windows update’e devam etmek için BIOS’a girerek boot device’ımı "debian"dan "Windows Boot Manager"a geçirdim. Bu isimler EFI bölümleri olmalı. GRUB, "debian" isimli yerde kurulu. "Windows Boot Manager" ile açınca GRUB ekranı gelmeden Windows açılıyor. Bu sayede güncelleme işlemini tamamlayabildim.</p>
<h2 id="cozum">Çözüm</h2>
<h3 id="1-deneme-basarsz">1. Deneme (Başarısız)</h3>
<p><a href="https://sourceforge.net/p/boot-repair-cd/home/Home/">Boot-Repair-Disk</a> imajını USB belleğe yazıp, bilgisayarı boot ettim. Doğrudan "Recommended repair" dediğim zaman bir şeyler yaptı ama hata devam etti. Kendisi Lubuntu 17.xx (04 ya da 10, an itibariyle) temelli Openbox çalıştıran minimal bir dağıtım.</p>
<p>Live bir dağıtım ile konsoldan GRUB kurmayı deneyeceğim. Sistemde "LVM over LUKS" var, ona dikkat etmem gerekir mi?</p>
<p>Ref:</p>
<ul>
<li><a href="https://askubuntu.com/questions/1098221/windows-10-update-grub-rescue">https://askubuntu.com/questions/1098221/windows-10-update-grub-rescue</a></li>
<li><a href="https://help.ubuntu.com/community/RecoveringUbuntuAfterInstallingWindows">https://help.ubuntu.com/community/RecoveringUbuntuAfterInstallingWindows</a></li>
<li><a href="https://help.ubuntu.com/community/Boot-Repair">https://help.ubuntu.com/community/Boot-Repair</a></li>
</ul>
<h3 id="2-deneme-basarl">2. Deneme (Başarılı)</h3>
<p>Boot-Repair-Disk işi hemen olmayınca elimde olan Ubuntu 18.04 imajı ile bilgisayarı boot ettim. Takip ettiğim kısım temel olarak şurası: <a href="https://help.ubuntu.com/community/Grub2/Installing#via_ChRoot">https://help.ubuntu.com/community/Grub2/Installing#via_ChRoot</a> "via ChRoot" kısmı. Benim sistemde root kısmı LVM üzerinde bulunuyor. Bu da şifreli bir partition üzerinde. Buna göre adımları biraz modifiye ettim. Bende RAID yok.</p>
<p>Ubuntu imajında Gparted dahili bulunuyor. Bu disk ile ilgili bilgilere hızlıca bakmak için iyi oldu. Kendi yazdığım komutlar şu şekilde. Siz yapıyorsanız harflere, numaralara dikkat edin.</p>
<p>İlk olarak şifreli diski açalım. Ubuntu imajında LVM ve dm-crypt ile ilgili şeyler kurulu olduğu için bir şey yüklemeye gerek yok.</p>
<pre><code class="shell">$ sudo cryptsetup open /dev/sdaX lv
</code></pre>

<p>Yukarıdaki <code>lv</code> rastgele bir isim, önemi yok. Burada diskin şifresini girmek gerekiyor. Disk otomatik bir şekilde boot esnasında açılıyor ve şifre bilinmiyorsa ne yapılır araştırmak lazım. Bu işlem için burayı da mount etmek gerekiyor mu onu da bilmiyorum aslında.</p>
<p>Şifreyi girdikten sonra LVM vs otomatik çalıştı ve partitionlarım gözüktü. Listelemek için:</p>
<pre><code class="shell">$ sudo lvdisplay
</code></pre>

<p>Burada <code>LV Path</code>e bakarak root dizinini mount edelim.</p>
<pre><code class="shell">$ sudo mount /dev/vg/root /mnt
</code></pre>

<p>Bu noktada <code>/mnt</code> altında dosyalarımızı görmemiz lazım. Ben burada <code>/etc/fstab</code>'tan kopya çektim. Ek olarak mount ettiğim iki partition daha var: <code>/boot</code> ve <code>/boot/efi</code>.</p>
<p>Örnek:</p>
<pre><code class="shell">$ sudo mount /dev/sdaY /mnt/boot
$ sudo mount /dev/sdaZ /mnt/boot/efi
</code></pre>

<p>Birazdan <code>chroot</code> yapacağız, onun için hazırlık yapıyoruz şimdi. Eğer bunları yapmazsak olmuyor mu denemedim.</p>
<pre><code class="shell">$ for i in /dev /dev/pts /proc /sys /run; do sudo mount -B $i /mnt$i; done
</code></pre>

<p>Sonra</p>
<pre><code class="shell">$ sudo chroot /mnt
# grub-install /dev/sda
# update-grub
</code></pre>

<p><code>CTRL-D</code> ile <code>chroot</code> içinden çıkıyoruz ve bilgisayarımızı yeniden başlatıyoruz. Bu noktada benim problemim çözüldü.</p>
<h2 id="sebebi-neydi-ki">Sebebi neydi ki?</h2>
<p>Şu an bulamadığım (tekrar çok da aramadım) bir linkte bunun Windows 10 ile ilgili bir bug olduğu yazıyor. Benzer işlemi masaüstü bilgisayarımda yaptım fakat onda Windows ile Linux veya hatta GRUB, tam konfigürasyon aklımda yok, fiziksel olarak ayrı disklerde olduğu için belki de bu problem olmadı. Her iki bilgisayar da EFI, fark burdan değil.</p>
<p>Dikkatimi çeken bir nokta da problem yaşadığım dizüstü bilgisyarın /etc/fstab girdisi oldu. Burada zamanında kurulum sırasında otomatik olarak UUID’lerle girdiler oluşturulurken bırakılmış yorumlar var. Diyor ki UUID bilmem ne zamanında /dev/sdaX’teydi. İlginç olan /boot/efi ile ilgili yorumda belirtilen paritition numarası hala doğruyken /boot ile ilgili yorumda yazan partition numarası, diskteki numaradan 1 fazla. Tabii bu farklılık önceden var mıydı bilmiyorum. Bu son işlem sırasında olmamış da olabilir. Fakat Windows update sırasında (aslında upgrade demek daha doğru buna) disk layout’u ile oynamış ve dual boot olma ihtimalini düşünmemiş olabilir.</p></div>
        
        
    </div>

    <footer class="col-md-12 text-center">
        
<hr>
<p>
    <small>License: <a href='https://creativecommons.org/licenses/by-sa/4.0/'>CC-BY-SA-4.0</a></small><br>



    <small><i>Last Updated on 2020-01-19</i></small><br>

<small>Built with <a href="http://www.mkdocs.org/">MkDocs</a> version 1.0.4 on 2020-02-16 18:13:14 UTC.</small><br>
<img src="https://img.shields.io/uptimerobot/ratio/m784066757-5d6b061dfaf9531f911b85ca.svg"/>
<a href="https://github.com/alperyazar/www/graphs/commit-activity"><img src="https://img.shields.io/github/commit-activity/m/alperyazar/www.svg"/></a>
<img src="https://img.shields.io/github/last-commit/alperyazar/www/master"/>
<img src="https://img.shields.io/github/repo-size/alperyazar/www"/>
<img src="https://img.shields.io/github/license/alperyazar/www"/>
</p>

    </footer>
    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
    <script src="../../../js/bootstrap-3.0.3.min.js"></script>
    
    <script src="//cdn.jsdelivr.net/gh/highlightjs/cdn-release@9.18.0/build/highlight.min.js"></script>
    <script src="//cdn.jsdelivr.net/gh/highlightjs/cdn-release@9.18.0/build/languages/matlab.min.js"></script>
    <script src="//cdn.jsdelivr.net/gh/highlightjs/cdn-release@9.18.0/build/languages/latex.min.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>
    
    <script>var base_url = "../../.."</script>
    
    <script src="../../../js/base.js"></script>
    <script src="../../../search/main.js"></script>

    <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="searchModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal">
                    <span aria-hidden="true">&times;</span>
                    <span class="sr-only">Close</span>
                </button>
                <h4 class="modal-title" id="searchModalLabel">Search</h4>
            </div>
            <div class="modal-body">
                <p>
                    From here you can search these documents. Enter
                    your search terms below.
                </p>
                <form>
                    <div class="form-group">
                        <input type="text" class="form-control" placeholder="Search..." id="mkdocs-search-query" title="Type search term here">
                    </div>
                </form>
                <div id="mkdocs-search-results"></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div><div class="modal" id="mkdocs_keyboard_modal" tabindex="-1" role="dialog" aria-labelledby="keyboardModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="keyboardModalLabel">Keyboard Shortcuts</h4>
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
            </div>
            <div class="modal-body">
              <table class="table">
                <thead>
                  <tr>
                    <th style="width: 20%;">Keys</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td class="help shortcut"><kbd>?</kbd></td>
                    <td>Open this help</td>
                  </tr>
                  <tr>
                    <td class="next shortcut"><kbd>n</kbd></td>
                    <td>Next page</td>
                  </tr>
                  <tr>
                    <td class="prev shortcut"><kbd>p</kbd></td>
                    <td>Previous page</td>
                  </tr>
                  <tr>
                    <td class="search shortcut"><kbd>s</kbd></td>
                    <td>Search</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>
    </body>

</html>
